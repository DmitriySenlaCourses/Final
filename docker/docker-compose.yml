version: '2'

services:
    zookeeper:
        image: confluentinc/cp-zookeeper:latest
        environment:
            ZOOKEEPER_CLIENT_PORT: 2181
            ZOOKEEPER_TICK_TIME: 2000
        ports:
            - 22181:2181
        restart: always

    kafka:
        image: confluentinc/cp-kafka:latest
        depends_on:
            - zookeeper
        ports:
            - 29092:29092
        environment:
            KAFKA_BROKER_ID: 1
            KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181
            KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://kafka:9092,PLAINTEXT_HOST://kafka:29092
            KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: PLAINTEXT:PLAINTEXT,PLAINTEXT_HOST:PLAINTEXT
            KAFKA_INTER_BROKER_LISTENER_NAME: PLAINTEXT
            KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 1
        restart: always

    my-tomcat:
#        container_name: tomcattest
        build:
            context: ./..
            dockerfile: docker/tomcat/dockerfile
        ports:
            - "8080:8080"
        depends_on:
            - my-mysql
            - kafka
        environment:
            - "url=jdbc:mysql://my-mysql:3306/prices?serverTimezone=UTC&useSSL=false&allowPublicKeyRetrieval=true"
            - "bootstrap.servers.config=kafka:9092"
    my-mysql:
#        container_name: mysqltest
        build:
            context: ./..
            dockerfile: docker/mysql/dockerfile
        ports:
            - "3308:3306"

